name: azure-cli
version:
  source: "github-release:Azure/azure-cli"
  extract_pattern: 'azure-cli-[0-9]+\.[0-9]+\.[0-9]+'
  cleanup: "s/azure-cli-//"
  exclude_patterns: "(alpha|beta|rc|dev|preview|pre|snapshot|nightly|test|unstable|canary|next|edge|weekly|daily)"
build_type: custom
description: "Azure CLI - Command-line interface for Microsoft Azure"

download:
  download_url: "https://github.com/Azure/azure-cli/archive/refs/tags/azure-cli-{version}.tar.gz"
  platforms:
    darwin-x86_64:
    darwin-arm64:
    linux-amd64:
    linux-arm64:

security:
  verify_signature: false
  scan_vulnerabilities: true

configure:
  script: |
    # Install from source using pip
    true

build:
  timeout_minutes: 30
  out_of_tree: false
  custom_install: |
    # Navigate to src/azure-cli where setup.py is located
    cd src/azure-cli

    # Install to a temporary location and copy to PREFIX
    mkdir -p $PREFIX/bin $PREFIX/lib
    PYTHONUSERBASE=$PREFIX python3 -m pip install --user --no-cache-dir .

    # Ensure binaries are in bin directory
    [ -d "$PREFIX/bin" ] || mkdir -p $PREFIX/bin
    if [ -d "$PREFIX/lib/python"*/site-packages/bin ]; then
      cp -r $PREFIX/lib/python*/site-packages/bin/* $PREFIX/bin/ 2>/dev/null || true
    fi

dependencies:
  - python
