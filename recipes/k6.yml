name: k6
description: Modern load testing tool - JavaScript-based with beautiful reports

version:
  source: "github-release:grafana/k6"
  extract_pattern: '[0-9]+\.[0-9]+\.[0-9]+'

build_type: custom

download:
  official_binary: true
  download_url: "https://github.com/grafana/k6/releases/download/v{version}/k6-v{version}-{suffix}"
  platforms:
    darwin-arm64:
      suffix: "macos-arm64.zip"
    darwin-x86_64:
      suffix: "macos-amd64.zip"
    linux-amd64:
      suffix: "linux-amd64.tar.gz"
    linux-arm64:
      suffix: "linux-arm64.tar.gz"

security:
  verify_signature: false
  # gpg_keys_url: ""  # Add URL to project KEYS file for auto-import
  scan_vulnerabilities: true

configure:
  script: |
    # Archive is already extracted by downloader
    true

build:
  custom_install: |
    mkdir -p $PREFIX/bin

    # Find k6 binary (it may be in a subdirectory)
    K6_BIN=$(find . -name k6 -type f | head -1)

    if [ -z "$K6_BIN" ]; then
      echo "Error: k6 binary not found" >&2
      echo "Contents of current directory:" >&2
      find . -type f >&2
      exit 1
    fi

    cp "$K6_BIN" $PREFIX/bin/k6
    chmod +x $PREFIX/bin/k6
